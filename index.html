<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2E8B57">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Music Player">
    <link rel="manifest" href="manifest.json">
    <title>Music Player v6 - Sync Edition</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        /* Color Themes */
        .bg-dark { background: #000; color: #fff; }
        .bg-light { background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 50%, #d4d4d4 100%); color: #000; }
        .sidebar-dark { background: #000; border-right: 1px solid rgba(255,255,255,0.15); }
        .sidebar-light { background: linear-gradient(180deg, #fff 0%, #f8f8f8 100%); border-right: 1px solid rgba(0,0,0,0.05); }
        
        .card-dark { 
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .card-light { 
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0,0,0,0.08);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        /* Layout */
        .container { display: flex; height: 100vh; overflow: hidden; }
        .sidebar { 
            width: 280px; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 16px; 
            overflow-y: auto; 
        }
        .main { flex: 1; overflow-y: auto; padding-bottom: 140px; }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #1DB954 0%, #1ed760 100%);
            box-shadow: 0 4px 15px rgba(29,185,84,0.4);
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 15px;
            transition: all 0.3s;
            width: 100%;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(29,185,84,0.5); }
        
        .btn-secondary {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.25);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 15px;
            transition: all 0.3s;
            width: 100%;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.22); }
        
        .bg-light .btn-secondary {
            background: rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.2);
            color: #000 !important;
        }
        .bg-light .btn-secondary:hover {
            background: rgba(0,0,0,0.1);
        }
        
        .icon-btn {
            background: rgba(255,255,255,0.12);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .icon-btn:hover { background: rgba(255,255,255,0.22); transform: scale(1.1); }
        .icon-btn-small { width: 32px; height: 32px; }
        
        .bg-light .icon-btn {
            background: rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.15);
        }
        .bg-light .icon-btn:hover { background: rgba(0,0,0,0.15); }
        
        /* User Profile Section */
        .user-profile { padding: 16px; border-radius: 12px; margin-bottom: 8px; }
        .user-info { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1DB954 0%, #1ed760 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: white;
            flex-shrink: 0;
        }
        .user-details { flex: 1; min-width: 0; }
        .user-name { font-weight: 600; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .user-email { font-size: 12px; opacity: 0.7; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Quota Monitor */
        .quota-monitor { padding: 12px; border-radius: 8px; margin-top: 12px; background: rgba(255,255,255,0.05); }
        .quota-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .quota-title { font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; font-weight: 600; }
        .quota-bar { height: 6px; background: rgba(255,255,255,0.15); border-radius: 3px; overflow: hidden; margin-bottom: 8px; }
        .quota-fill { height: 100%; transition: width 0.3s, background 0.3s; border-radius: 3px; }
        .quota-fill.excellent, .quota-fill.great, .quota-fill.good { background: #10b981; }
        .quota-fill.moderate { background: #f59e0b; }
        .quota-fill.high, .quota-fill.very-high { background: #ef4444; }
        .quota-status { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; }
        .quota-description { font-size: 11px; opacity: 0.7; margin-top: 4px; }
        .quota-help-btn {
            background: none;
            border: none;
            color: inherit;
            opacity: 0.6;
            cursor: pointer;
            font-size: 11px;
            text-decoration: underline;
            padding: 4px 0;
            margin-top: 4px;
        }
        .quota-help-btn:hover { opacity: 1; }
        
        /* Guest CTA */
        .guest-cta { text-align: center; padding: 20px 16px; }
        .guest-cta-title { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .guest-cta-desc { font-size: 13px; opacity: 0.7; margin-bottom: 16px; line-height: 1.4; }
        
        /* Library Stats */
        .library-stats { padding: 16px; border-radius: 12px; margin-top: 8px; background: rgba(255,255,255,0.05); }
        .stats-title { font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.7; font-weight: 600; margin-bottom: 12px; }
        .stat-item { padding: 6px 0; display: flex; justify-content: space-between; font-size: 13px; }
        .stat-label { opacity: 0.7; }
        .stat-value { font-weight: 600; }
        
        /* Search */
        input[type="text"], input[type="search"] {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: none;
            outline: none;
            font-size: 14px;
        }
        .bg-dark input { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); color: white; }
        .bg-dark input::placeholder { color: rgba(255,255,255,0.5); }
        .bg-light input { background: rgba(0,0,0,0.05); border: 1px solid rgba(0,0,0,0.1); color: #1a1a1a; }
        
        .global-search { position: relative; margin-bottom: 24px; }
        .search-icon { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); opacity: 0.5; pointer-events: none; }
        .global-search input { padding-left: 48px; }
        
        /* Stats Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 32px;
        }
        .stats-card { padding: 20px; border-radius: 12px; text-align: center; }
        .stats-card-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .stats-card-label { font-size: 13px; opacity: 0.7; }
        
        /* Playlist Grid */
        .playlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }
        .playlist-grid-card {
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
        }
        .playlist-grid-card:hover { transform: translateY(-4px); }
        .grid-menu-btn { position: absolute; top: 8px; right: 8px; opacity: 0; transition: opacity 0.2s; }
        .playlist-grid-card:hover .grid-menu-btn { opacity: 1; }
        
        /* Song Items */
        .song-item { 
            padding: 16px; 
            border-radius: 12px; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            gap: 16px;
            margin-bottom: 8px;
        }
        .song-item:hover { transform: scale(1.01); }
        .song-item.active { background: rgba(29,185,84,0.15) !important; }
        
        .drag-handle {
            color: rgba(255,255,255,0.4);
            font-size: 18px;
            cursor: grab;
            user-select: none;
        }
        .bg-light .drag-handle { color: rgba(0,0,0,0.3); }
        
        /* Player */
        .player { 
            position: fixed; 
            bottom: 0; 
            left: 0; 
            right: 0; 
            padding: 12px 20px; 
            z-index: 50;
            background: #2a2a2a !important;
        }
        .bg-light .player {
            background: rgba(255,255,255,0.95) !important;
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0,0,0,0.08);
        }
        .player-info { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 8px; }
        .player-controls { display: flex; align-items: center; justify-content: center; gap: 8px; }
        .player-main { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
        .progress-bar { height: 6px; background: rgba(255,255,255,0.25); border-radius: 3px; cursor: pointer; flex: 1; margin-bottom: 10px; }
        .progress-fill { height: 100%; background: #1DB954; border-radius: 3px; transition: width 0.1s linear; }
        
        /* Modal */
        .modal-overlay { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.85); 
            backdrop-filter: blur(8px); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 1000;
            padding: 20px;
        }
        .modal { padding: 28px; border-radius: 16px; width: 100%; max-width: 420px; max-height: 90vh; overflow-y: auto; }
        .modal-dark { background: rgba(30,30,40,0.98); border: 1px solid rgba(255,255,255,0.2); color: #fff; }
        .modal-light { background: rgba(255,255,255,0.98); border: 1px solid rgba(0,0,0,0.1); color: #1a1a1a; }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: #fff;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #1DB954;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Context Menu */
        .context-menu {
            position: absolute;
            background: rgba(40,40,50,0.98);
            border: 1px solid rgba(255,255,255,0.25);
            border-radius: 8px;
            padding: 8px;
            z-index: 100;
            min-width: 160px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }
        .context-menu-item {
            padding: 10px 14px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
        }
        .context-menu-item:hover { background: rgba(255,255,255,0.15); }
        
        /* Utilities */
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .font-bold { font-weight: 700; }
        .text-xl { font-size: 20px; }
        .text-2xl { font-size: 24px; }
        .text-3xl { font-size: 30px; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Mobile */
        @media (max-width: 768px) {
            .sidebar { 
                position: fixed; 
                left: -100%; 
                top: 0; 
                bottom: 0; 
                z-index: 60; 
                width: 85%; 
                max-width: 320px; 
                transition: left 0.3s; 
            }
            .sidebar.open { left: 0; }
            .mobile-header { display: flex; padding: 16px 20px; align-items: center; gap: 16px; }
            .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 50; }
            .overlay.open { display: block; }
            .main { padding-bottom: 200px; }
            .hide-mobile { display: none !important; }
            .playlist-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .stats-dashboard { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .player { padding: 10px 16px; }
            .player-main { flex-direction: column; gap: 12px; }
        }
        @media (min-width: 769px) {
            .mobile-header { display: none; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script>
        const { useState, useEffect, useRef } = React;
        const PRIMARY = '#1DB954';
        
        // NOTE: Replace these with your actual Google Drive API credentials
        // Get them from: https://console.cloud.google.com/
        const GOOGLE_CONFIG = {
            CLIENT_ID: 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com',
            API_KEY: 'YOUR_API_KEY_HERE',
            DISCOVERY_DOCS: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            SCOPES: 'https://www.googleapis.com/auth/drive.file',
            FOLDER_NAME: 'DharmaMusicPlayer' // Folder name in Google Drive
        };

        const debugLog = (msg, data) => console.log(`[MusicPlayer] ${msg}`, data || '');
        
        // Helper Functions
        const formatTime = (s) => {
            if (!s || isNaN(s)) return '0:00';
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec.toString().padStart(2, '0')}`;
        };
        
        const formatFileSize = (bytes) => {
            if (!bytes) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 10) / 10 + ' ' + sizes[i];
        };
        
        const getQuotaLevel = (calls) => {
            if (calls === 0) return { level: 'excellent', icon: 'âœ¨', message: 'No syncs today yet', desc: 'You have plenty of room!', percent: 0 };
            if (calls < 50) return { level: 'great', icon: 'ðŸ‘', message: 'Very light usage', desc: "You're doing great!", percent: (calls / 50) * 35 };
            if (calls < 200) return { level: 'good', icon: 'âœ“', message: 'Normal usage', desc: 'Everything looks good', percent: 35 + ((calls - 50) / 150) * 30 };
            if (calls < 500) return { level: 'moderate', icon: 'ðŸ“Š', message: 'Moderate usage', desc: 'Still plenty of room', percent: 65 + ((calls - 200) / 300) * 20 };
            if (calls < 800) return { level: 'high', icon: 'âš ï¸', message: 'High usage today', desc: 'Consider syncing less often', percent: 85 + ((calls - 500) / 300) * 10 };
            return { level: 'very-high', icon: 'ðŸ”´', message: 'Very high usage', desc: 'Take a break from syncing', percent: Math.min(100, 95 + ((calls - 800) / 200) * 5) };
        };
        
        // SVG Icons
        const Icons = {
            Sun: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('circle', { cx: '12', cy: '12', r: '5' }),
                React.createElement('line', { x1: '12', y1: '1', x2: '12', y2: '3' }),
                React.createElement('line', { x1: '12', y1: '21', x2: '12', y2: '23' }),
                React.createElement('line', { x1: '4.22', y1: '4.22', x2: '5.64', y2: '5.64' }),
                React.createElement('line', { x1: '18.36', y1: '18.36', x2: '19.78', y2: '19.78' }),
                React.createElement('line', { x1: '1', y1: '12', x2: '3', y2: '12' }),
                React.createElement('line', { x1: '21', y1: '12', x2: '23', y2: '12' }),
                React.createElement('line', { x1: '4.22', y1: '19.78', x2: '5.64', y2: '18.36' }),
                React.createElement('line', { x1: '18.36', y1: '5.64', x2: '19.78', y2: '4.22' })
            ),
            Moon: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('path', { d: 'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z' })
            ),
            Menu: () => React.createElement('svg', { width: '24', height: '24', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('line', { x1: '3', y1: '6', x2: '21', y2: '6' }),
                React.createElement('line', { x1: '3', y1: '12', x2: '21', y2: '12' }),
                React.createElement('line', { x1: '3', y1: '18', x2: '21', y2: '18' })
            ),
            ArrowLeft: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('line', { x1: '19', y1: '12', x2: '5', y2: '12' }),
                React.createElement('polyline', { points: '12 19 5 12 12 5' })
            ),
            Play: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('polygon', { points: '5 3 19 12 5 21 5 3' })
            ),
            Pause: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('rect', { x: '6', y: '4', width: '4', height: '16' }),
                React.createElement('rect', { x: '14', y: '4', width: '4', height: '16' })
            ),
            SkipBack: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('polygon', { points: '19 20 9 12 19 4 19 20' }),
                React.createElement('rect', { x: '5', y: '4', width: '2', height: '16' })
            ),
            SkipForward: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('polygon', { points: '5 4 15 12 5 20 5 4' }),
                React.createElement('rect', { x: '17', y: '4', width: '2', height: '16' })
            ),
            Repeat: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('polyline', { points: '17 1 21 5 17 9' }),
                React.createElement('path', { d: 'M3 11V9a4 4 0 0 1 4-4h14' }),
                React.createElement('polyline', { points: '7 23 3 19 7 15' }),
                React.createElement('path', { d: 'M21 13v2a4 4 0 0 1-4 4H3' })
            ),
            Volume: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('polygon', { points: '11 5 6 9 2 9 2 15 6 15 11 19 11 5' }),
                React.createElement('path', { d: 'M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07' })
            ),
            Trash: () => React.createElement('svg', { width: '18', height: '18', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('polyline', { points: '3 6 5 6 21 6' }),
                React.createElement('path', { d: 'M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2' })
            ),
            Upload: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('path', { d: 'M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4' }),
                React.createElement('polyline', { points: '17 8 12 3 7 8' }),
                React.createElement('line', { x1: '12', y1: '3', x2: '12', y2: '15' })
            ),
            Link: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('path', { d: 'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71' }),
                React.createElement('path', { d: 'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71' })
            ),
            Music: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('path', { d: 'M9 18V5l12-2v13' }),
                React.createElement('circle', { cx: '6', cy: '18', r: '3' }),
                React.createElement('circle', { cx: '18', cy: '16', r: '3' })
            ),
            MoreVertical: () => React.createElement('svg', { width: '18', height: '18', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('circle', { cx: '12', cy: '5', r: '2' }),
                React.createElement('circle', { cx: '12', cy: '12', r: '2' }),
                React.createElement('circle', { cx: '12', cy: '19', r: '2' })
            ),
            Copy: () => React.createElement('svg', { width: '18', height: '18', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('rect', { x: '9', y: '9', width: '13', height: '13', rx: '2', ry: '2' }),
                React.createElement('path', { d: 'M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1' })
            ),
            GripVertical: () => React.createElement('svg', { width: '16', height: '16', viewBox: '0 0 24 24', fill: 'currentColor' },
                React.createElement('circle', { cx: '9', cy: '5', r: '1' }),
                React.createElement('circle', { cx: '9', cy: '12', r: '1' }),
                React.createElement('circle', { cx: '9', cy: '19', r: '1' }),
                React.createElement('circle', { cx: '15', cy: '5', r: '1' }),
                React.createElement('circle', { cx: '15', cy: '12', r: '1' }),
                React.createElement('circle', { cx: '15', cy: '19', r: '1' })
            ),
            Edit: () => React.createElement('svg', { width: '18', height: '18', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('path', { d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7' }),
                React.createElement('path', { d: 'M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z' })
            ),
            Search: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('circle', { cx: '11', cy: '11', r: '8' }),
                React.createElement('path', { d: 'm21 21-4.35-4.35' })
            ),
            Sync: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('path', { d: 'M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2' })
            ),
            Cloud: () => React.createElement('svg', { width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('path', { d: 'M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z' })
            ),
            HelpCircle: () => React.createElement('svg', { width: '16', height: '16', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2' },
                React.createElement('circle', { cx: '12', cy: '12', r: '10' }),
                React.createElement('path', { d: 'M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3' }),
                React.createElement('line', { x1: '12', y1: '17', x2: '12.01', y2: '17' })
            )
        };
        
        // IndexedDB Setup
        const initDB = () => {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open('MusicDB', 3);
                req.onerror = () => reject(req.error);
                req.onsuccess = () => resolve(req.result);
                req.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('playlists')) db.createObjectStore('playlists', { keyPath: 'id' });
                    if (!db.objectStoreNames.contains('songs')) db.createObjectStore('songs', { keyPath: 'id' });
                    if (!db.objectStoreNames.contains('settings')) db.createObjectStore('settings', { keyPath: 'key' });
                };
            });
        };

        const DB = {
            async save(store, data) {
                const db = await initDB();
                return new Promise((resolve, reject) => {
                    const tx = db.transaction(store, 'readwrite');
                    const req = tx.objectStore(store).put(data);
                    req.onsuccess = () => resolve(req.result);
                    req.onerror = () => reject(req.error);
                });
            },
            async get(store, key) {
                try {
                    const db = await initDB();
                    return new Promise((resolve) => {
                        const tx = db.transaction(store, 'readonly');
                        const req = tx.objectStore(store).get(key);
                        req.onsuccess = () => resolve(req.result);
                        req.onerror = () => resolve(null);
                    });
                } catch (e) {
                    return null;
                }
            },
            async getAll(store) {
                try {
                    const db = await initDB();
                    return new Promise((resolve) => {
                        const tx = db.transaction(store, 'readonly');
                        const req = tx.objectStore(store).getAll();
                        req.onsuccess = () => resolve(req.result || []);
                        req.onerror = () => resolve([]);
                    });
                } catch (e) {
                    return [];
                }
            },
            async delete(store, key) {
                try {
                    const db = await initDB();
                    return new Promise((resolve) => {
                        const tx = db.transaction(store, 'readwrite');
                        const req = tx.objectStore(store).delete(key);
                        req.onsuccess = () => resolve();
                        req.onerror = () => resolve();
                    });
                } catch (e) {}
            }
        };
        
        // Quota Tracking
        const QuotaTracker = {
            async track(apiCalls) {
                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                
                let quota = await DB.get('settings', 'quotaTracking') || {
                    dailyCalls: 0,
                    totalCalls: 0,
                    lastReset: todayStart,
                    history: []
                };
                
                if (quota.lastReset < todayStart) {
                    quota.dailyCalls = 0;
                    quota.lastReset = todayStart;
                }
                
                quota.dailyCalls += apiCalls;
                quota.totalCalls += apiCalls;
                quota.history.push({ timestamp: now.getTime(), calls: apiCalls });
                if (quota.history.length > 30) quota.history = quota.history.slice(-30);
                
                await DB.save('settings', { key: 'quotaTracking', value: quota });
                return quota;
            },
            
            async get() {
                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                
                let quota = await DB.get('settings', 'quotaTracking') || {
                    dailyCalls: 0,
                    totalCalls: 0,
                    lastReset: todayStart,
                    history: []
                };
                
                if (quota.lastReset < todayStart) {
                    quota.dailyCalls = 0;
                    quota.lastReset = todayStart;
                    await DB.save('settings', { key: 'quotaTracking', value: quota });
                }
                
                return quota;
            }
        };
        
        // Google Drive Sync Functions (Stub - requires actual Google API setup)
        const DriveSync = {
            isSignedIn: false,
            userInfo: null,
            
            async init() {
                // This is a stub - you'll need to implement actual Google Sign-In
                debugLog('DriveSync: Init called (stub)');
                // In real implementation, load Google API and check auth status
                const savedAuth = await DB.get('settings', 'googleAuth');
                if (savedAuth?.value) {
                    this.isSignedIn = true;
                    this.userInfo = savedAuth.value;
                }
                return this.isSignedIn;
            },
            
            async signIn() {
                // Stub for Google Sign-In
                debugLog('DriveSync: SignIn called (stub)');
                alert('Google Drive sync requires API credentials.\n\nTo enable sync:\n1. Get credentials from https://console.cloud.google.com/\n2. Replace GOOGLE_CONFIG in the code\n3. Implement OAuth flow');
                return false;
            },
            
            async signOut() {
                this.isSignedIn = false;
                this.userInfo = null;
                await DB.delete('settings', 'googleAuth');
                debugLog('DriveSync: Signed out');
            },
            
            async sync() {
                if (!this.isSignedIn) {
                    throw new Error('Not signed in');
                }
                
                debugLog('DriveSync: Sync started (stub)');
                // Stub - in real implementation:
                // 1. List files in Drive folder
                // 2. Compare with local songs
                // 3. Upload new local songs
                // 4. Download new Drive songs
                // 5. Track API calls
                
                await QuotaTracker.track(5); // Simulate API calls
                return { uploaded: 0, downloaded: 0, deleted: 0 };
            }
        };
        
        // Main React Component
        function MusicPlayer() {
            const [playlists, setPlaylists] = useState([]);
            const [view, setView] = useState('home');
            const [currentSong, setCurrentSong] = useState(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [repeat, setRepeat] = useState(false);
            const [progress, setProgress] = useState(0);
            const [volume, setVolume] = useState(80);
            const [darkMode, setDarkMode] = useState(true);
            const [searchQuery, setSearchQuery] = useState('');
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [showModal, setShowModal] = useState(null);
            const [modalInput, setModalInput] = useState('');
            const [loading, setLoading] = useState(true);
            const [contextMenu, setContextMenu] = useState(null);
            const [quota, setQuota] = useState({ dailyCalls: 0 });
            const [isSignedIn, setIsSignedIn] = useState(false);
            const [userInfo, setUserInfo] = useState(null);
            const [syncing, setSyncing] = useState(false);
            
            const audioRef = useRef(null);
            const fileInputRef = useRef(null);
            const saveTimeoutRef = useRef(null);

            const bg = darkMode ? 'bg-dark' : 'bg-light';
            const sidebar = darkMode ? 'sidebar-dark' : 'sidebar-light';
            const card = darkMode ? 'card-dark' : 'card-light';
            const modalClass = darkMode ? 'modal-dark' : 'modal-light';

            // Load data on mount
            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    setLoading(true);
                    
                    const [lists, mode, vol, authStatus, quotaData] = await Promise.all([
                        DB.getAll('playlists'),
                        DB.get('settings', 'darkMode'),
                        DB.get('settings', 'volume'),
                        DriveSync.init(),
                        QuotaTracker.get()
                    ]);
                    
                    if (lists && lists.length > 0) setPlaylists(lists);
                    if (mode) setDarkMode(mode.value);
                    if (vol) setVolume(vol.value);
                    setIsSignedIn(DriveSync.isSignedIn);
                    setUserInfo(DriveSync.userInfo);
                    setQuota(quotaData);
                    
                } catch (e) {
                    debugLog('Load error:', e);
                } finally {
                    setTimeout(() => setLoading(false), 300);
                }
            };

            // Save playlists (debounced)
            useEffect(() => {
                if (loading) return;
                
                if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
                
                saveTimeoutRef.current = setTimeout(async () => {
                    for (const p of playlists) {
                        await DB.save('playlists', p);
                    }
                }, 500);
                
                return () => {
                    if (saveTimeoutRef.current) clearTimeout(saveTimeoutRef.current);
                };
            }, [playlists, loading]);

            useEffect(() => {
                if (!loading) DB.save('settings', { key: 'darkMode', value: darkMode });
            }, [darkMode, loading]);

            useEffect(() => {
                if (!loading) DB.save('settings', { key: 'volume', value: volume });
            }, [volume, loading]);

            useEffect(() => {
                if (audioRef.current && currentSong) {
                    audioRef.current.src = currentSong.url;
                    audioRef.current.load();
                    if (isPlaying) audioRef.current.play().catch(() => setIsPlaying(false));
                }
            }, [currentSong]);

            useEffect(() => {
                if (audioRef.current && currentSong) {
                    if (isPlaying) audioRef.current.play().catch(() => setIsPlaying(false));
                    else audioRef.current.pause();
                }
            }, [isPlaying]);

            useEffect(() => {
                if (audioRef.current) audioRef.current.volume = volume / 100;
            }, [volume]);

            useEffect(() => {
                const handleClick = () => setContextMenu(null);
                document.addEventListener('click', handleClick);
                return () => document.removeEventListener('click', handleClick);
            }, []);

            // Functions
            const createPlaylist = () => {
                setModalInput('');
                setShowModal('create');
            };

            const handleCreate = async () => {
                if (modalInput.trim()) {
                    const id = Date.now();
                    const newPlaylist = { id, name: modalInput.trim(), songs: [] };
                    await DB.save('playlists', newPlaylist);
                    setPlaylists([...playlists, newPlaylist]);
                    setShowModal(null);
                }
            };

            const deletePlaylist = async (id) => {
                const p = playlists.find(x => x.id === id);
                if (p) {
                    for (const s of p.songs) {
                        if (!s.isUrl) await DB.delete('songs', s.id);
                    }
                    await DB.delete('playlists', id);
                }
                
                setPlaylists(playlists.filter(x => x.id !== id));
                setContextMenu(null);
                setShowModal(null);
            };

            const handleFileUpload = async (e, playlistId) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                
                const playlist = playlists.find(p => p.id === playlistId);
                if (!playlist) return;

                for (const file of files) {
                    const id = Date.now() + Math.random();
                    const song = { 
                        id, 
                        name: file.name.replace(/\.[^/.]+$/, ''), 
                        isUrl: false 
                    };
                    await DB.save('songs', { id, blob: file });
                    playlist.songs.push(song);
                }
                
                await DB.save('playlists', playlist);
                setPlaylists([...playlists]);
                
                if (fileInputRef.current) fileInputRef.current.value = '';
            };

            const playSong = async (song, pid) => {
                if (song.isUrl) {
                    setCurrentSong({ ...song, playlistId: pid });
                } else {
                    const data = await DB.get('songs', song.id);
                    if (data?.blob) {
                        const url = URL.createObjectURL(data.blob);
                        setCurrentSong({ ...song, playlistId: pid, url });
                    }
                }
                setIsPlaying(true);
            };

            const playNext = () => {
                if (!currentSong) return;
                const p = playlists.find(x => x.id === currentSong.playlistId);
                if (p && p.songs.length > 0) {
                    const idx = p.songs.findIndex(s => s.id === currentSong.id);
                    const nextIdx = (idx + 1) % p.songs.length;
                    playSong(p.songs[nextIdx], p.id);
                }
            };

            const playPrevious = () => {
                if (!currentSong) return;
                const p = playlists.find(x => x.id === currentSong.playlistId);
                if (p && p.songs.length > 0) {
                    const idx = p.songs.findIndex(s => s.id === currentSong.id);
                    const prevIdx = idx === 0 ? p.songs.length - 1 : idx - 1;
                    playSong(p.songs[prevIdx], p.id);
                }
            };

            const deleteSong = async (id, pid) => {
                const p = playlists.find(x => x.id === pid);
                if (p) {
                    const s = p.songs.find(x => x.id === id);
                    if (s && !s.isUrl) await DB.delete('songs', s.id);
                    p.songs = p.songs.filter(x => x.id !== id);
                    await DB.save('playlists', p);
                    setPlaylists([...playlists]);
                }
                setShowModal(null);
            };

            const handleSync = async () => {
                try {
                    setSyncing(true);
                    const result = await DriveSync.sync();
                    const quotaData = await QuotaTracker.get();
                    setQuota(quotaData);
                    alert(`Sync complete!\nUploaded: ${result.uploaded}\nDownloaded: ${result.downloaded}`);
                } catch (e) {
                    alert('Sync error: ' + e.message);
                } finally {
                    setSyncing(false);
                }
            };

            const handleSignIn = async () => {
                const success = await DriveSync.signIn();
                if (success) {
                    setIsSignedIn(true);
                    setUserInfo(DriveSync.userInfo);
                }
            };

            const handleSignOut = async () => {
                await DriveSync.signOut();
                setIsSignedIn(false);
                setUserInfo(null);
            };

            // Calculate stats
            const totalSongs = playlists.reduce((sum, p) => sum + p.songs.length, 0);
            const quotaLevel = getQuotaLevel(quota.dailyCalls);
            
            // Search filtering
            const searchResults = searchQuery.trim() ? playlists.map(p => ({
                ...p,
                songs: p.songs.filter(s => s.name.toLowerCase().includes(searchQuery.toLowerCase())),
                matchesName: p.name.toLowerCase().includes(searchQuery.toLowerCase())
            })).filter(p => p.matchesName || p.songs.length > 0) : playlists;

            if (loading) {
                return React.createElement('div', { className: 'loading-overlay' },
                    React.createElement('div', { className: 'spinner' }),
                    React.createElement('div', { style: { marginTop: '20px', fontSize: '18px' } }, 'Loading your library...'));
            }

            if (playlists.length === 0 && !showModal) {
                return React.createElement('div', { className: bg, style: { height: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: '20px' } },
                    React.createElement('div', { style: { textAlign: 'center', maxWidth: '500px' } },
                        React.createElement('div', { style: { fontSize: '30px', fontWeight: '700', marginBottom: '16px' } }, 'Welcome to Music Player'),
                        React.createElement('div', { style: { fontSize: '16px', marginBottom: '24px', opacity: 0.7 } }, 
                            'Create your first playlist to start organizing your dharma instrument recordings.'
                        ),
                        React.createElement('button', { onClick: createPlaylist, className: 'btn-primary' }, 'Create Your First Playlist')
                    )
                );
            }
            
            // Main Render
            return React.createElement('div', null,
                // Audio element
                React.createElement('audio', {
                    ref: audioRef,
                    onTimeUpdate: (e) => {
                        if (e.target.duration) {
                            setProgress((e.target.currentTime / e.target.duration) * 100);
                        }
                    },
                    onEnded: () => {
                        if (repeat && audioRef.current) {
                            audioRef.current.currentTime = 0;
                            audioRef.current.play().catch(err => {
                                setTimeout(() => {
                                    if (audioRef.current) audioRef.current.play();
                                }, 100);
                            });
                        } else {
                            playNext();
                        }
                    }
                }),
                
                // File input
                React.createElement('input', {
                    ref: fileInputRef,
                    type: 'file',
                    multiple: true,
                    accept: 'audio/*,.mp3,.m4a,.wav,.aac,.flac,.ogg,.mp4',
                    onChange: (e) => {
                        const activeP = playlists.find(p => p.id === view);
                        if (activeP) handleFileUpload(e, activeP.id);
                    },
                    style: { display: 'none' }
                }),
                
                // Overlay for mobile sidebar
                React.createElement('div', { 
                    className: `overlay ${sidebarOpen ? 'open' : ''}`, 
                    onClick: () => setSidebarOpen(false) 
                }),
                
                // Context Menu
                contextMenu && React.createElement('div', {
                    className: 'context-menu',
                    style: { top: contextMenu.y, left: contextMenu.x },
                    onClick: (e) => e.stopPropagation()
                },
                    React.createElement('div', {
                        className: 'context-menu-item',
                        onClick: () => {
                            setShowModal({ type: 'delete-playlist', id: contextMenu.playlist.id });
                            setContextMenu(null);
                        }
                    },
                        React.createElement(Icons.Trash),
                        'Delete'
                    )
                ),
                
                // Main Container
                React.createElement('div', { className: `container ${bg}` },
                    // SIDEBAR
                    React.createElement('div', { className: `sidebar ${sidebar} ${sidebarOpen ? 'open' : ''}` },
                        // Header with theme toggle
                        React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                            React.createElement('div', { style: { fontSize: '20px', fontWeight: '700' } }, 'ðŸŽµ'),
                            React.createElement('button', {
                                onClick: () => setDarkMode(!darkMode),
                                className: 'icon-btn icon-btn-small'
                            }, darkMode ? React.createElement(Icons.Sun) : React.createElement(Icons.Moon))
                        ),
                        
                        // User Profile / Guest CTA
                        isSignedIn ? (
                            React.createElement('div', { className: `user-profile ${card}` },
                                React.createElement('div', { className: 'user-info' },
                                    React.createElement('div', { className: 'user-avatar' },
                                        userInfo?.name?.charAt(0).toUpperCase() || 'ðŸ‘¤'
                                    ),
                                    React.createElement('div', { className: 'user-details' },
                                        React.createElement('div', { className: 'user-name' }, userInfo?.name || 'User'),
                                        React.createElement('div', { className: 'user-email' }, userInfo?.email || '')
                                    )
                                ),
                                React.createElement('button', { 
                                    onClick: handleSync,
                                    disabled: syncing,
                                    className: 'btn-primary' 
                                }, syncing ? 'Syncing...' : 'ðŸ”„ Sync Now'),
                                
                                React.createElement('div', { className: 'quota-monitor' },
                                    React.createElement('div', { className: 'quota-header' },
                                        React.createElement('div', { className: 'quota-title' }, "Today's Activity")
                                    ),
                                    React.createElement('div', { className: 'quota-bar' },
                                        React.createElement('div', { 
                                            className: `quota-fill ${quotaLevel.level}`,
                                            style: { width: `${quotaLevel.percent}%` }
                                        })
                                    ),
                                    React.createElement('div', { className: 'quota-status' },
                                        React.createElement('span', {}, quotaLevel.icon),
                                        React.createElement('span', {}, quotaLevel.message)
                                    ),
                                    React.createElement('div', { className: 'quota-description' }, quotaLevel.desc),
                                    React.createElement('button', {
                                        className: 'quota-help-btn',
                                        onClick: () => setShowModal('quota-help')
                                    }, 'What does this mean?')
                                )
                            )
                        ) : (
                            React.createElement('div', { className: `guest-cta ${card}` },
                                React.createElement('div', { style: { fontSize: '32px', marginBottom: '12px' } }, 'â˜ï¸'),
                                React.createElement('div', { className: 'guest-cta-title' }, 'Sync Across Devices'),
                                React.createElement('div', { className: 'guest-cta-desc' }, 
                                    'Sign in to sync your music library across all devices'
                                ),
                                React.createElement('button', { 
                                    onClick: handleSignIn,
                                    className: 'btn-primary' 
                                }, 'Sign in with Google Drive')
                            )
                        ),
                        
                        // Library Stats
                        React.createElement('div', { className: `library-stats ${card}` },
                            React.createElement('div', { className: 'stats-title' }, 'ðŸ“Š Your Collection'),
                            React.createElement('div', { className: 'stat-item' },
                                React.createElement('span', { className: 'stat-label' }, 'Playlists'),
                                React.createElement('span', { className: 'stat-value' }, playlists.length)
                            ),
                            React.createElement('div', { className: 'stat-item' },
                                React.createElement('span', { className: 'stat-label' }, 'Songs'),
                                React.createElement('span', { className: 'stat-value' }, totalSongs)
                            )
                        )
                    ),
                    
                    // MAIN CONTENT
                    React.createElement('div', { className: 'main' },
                        // Mobile header
                        React.createElement('div', { className: `mobile-header ${card}` },
                            React.createElement('button', { 
                                onClick: () => setSidebarOpen(true),
                                className: 'icon-btn icon-btn-small'
                            }, React.createElement(Icons.Menu)),
                            React.createElement('div', { style: { fontSize: '20px', fontWeight: '700' } }, 'Music Player')
                        ),
                        
                        // Main content area
                        React.createElement('div', { style: { padding: '32px 24px' } },
                            // Global Search
                            React.createElement('div', { className: 'global-search' },
                                React.createElement('div', { className: 'search-wrapper' },
                                    React.createElement('div', { className: 'search-icon' }, React.createElement(Icons.Search)),
                                    React.createElement('input', {
                                        type: 'search',
                                        placeholder: 'Search playlists or songs...',
                                        value: searchQuery,
                                        onChange: (e) => setSearchQuery(e.target.value)
                                    })
                                )
                            ),
                            
                            // Create Playlist Button
                            React.createElement('button', { 
                                onClick: createPlaylist, 
                                className: 'btn-primary mb-6',
                                style: { maxWidth: '300px' }
                            }, '+ New Playlist'),
                            
                            // Stats Dashboard
                            React.createElement('div', { className: 'stats-dashboard' },
                                React.createElement('div', { className: `stats-card ${card}` },
                                    React.createElement('div', { className: 'stats-card-value' }, playlists.length),
                                    React.createElement('div', { className: 'stats-card-label' }, 'Playlists')
                                ),
                                React.createElement('div', { className: `stats-card ${card}` },
                                    React.createElement('div', { className: 'stats-card-value' }, totalSongs),
                                    React.createElement('div', { className: 'stats-card-label' }, 'Songs')
                                ),
                                React.createElement('div', { className: `stats-card ${card}` },
                                    React.createElement('div', { className: 'stats-card-value' }, quota.totalCalls || 0),
                                    React.createElement('div', { className: 'stats-card-label' }, 'Total Syncs')
                                )
                            ),
                            
                            // Section Header
                            React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                                React.createElement('div', { style: { fontSize: '24px', fontWeight: '700' } }, 'Your Playlists')
                            ),
                            
                            // Playlist Grid
                            searchResults.length > 0 ? (
                                React.createElement('div', { className: 'playlist-grid' },
                                    searchResults.map(p => React.createElement('div', {
                                        key: p.id,
                                        onClick: () => setView(p.id),
                                        className: `playlist-grid-card ${card}`,
                                        style: view === p.id ? { borderColor: PRIMARY, borderWidth: '2px' } : {}
                                    },
                                        React.createElement('button', {
                                            className: 'grid-menu-btn icon-btn icon-btn-small',
                                            onClick: (e) => {
                                                e.stopPropagation();
                                                setContextMenu({
                                                    x: e.clientX - 160,
                                                    y: e.clientY,
                                                    playlist: p
                                                });
                                            }
                                        }, React.createElement(Icons.MoreVertical)),
                                        React.createElement('div', { style: { fontSize: '48px', marginBottom: '12px' } }, 'ðŸŽµ'),
                                        React.createElement('div', { style: { fontWeight: '700', marginBottom: '4px' } }, p.name),
                                        React.createElement('div', { style: { fontSize: '13px', opacity: 0.7 } }, `${p.songs.length} tracks`)
                                    ))
                                )
                            ) : (
                                React.createElement('div', { style: { textAlign: 'center', padding: '60px 20px', opacity: 0.5 } },
                                    'No playlists found'
                                )
                            ),
                            
                            // Playlist View (when playlist is selected)
                            view !== 'home' && playlists.find(p => p.id === view) && (() => {
                                const currentPlaylist = playlists.find(p => p.id === view);
                                return React.createElement('div', { style: { marginTop: '48px' } },
                                    React.createElement('div', { className: 'flex items-center justify-between mb-6' },
                                        React.createElement('div', { className: 'flex items-center gap-3' },
                                            React.createElement('button', {
                                                onClick: () => setView('home'),
                                                className: 'icon-btn'
                                            }, React.createElement(Icons.ArrowLeft)),
                                            React.createElement('div', {},
                                                React.createElement('div', { style: { fontSize: '30px', fontWeight: '700' } }, currentPlaylist.name),
                                                React.createElement('div', { style: { fontSize: '14px', opacity: 0.7 } }, `${currentPlaylist.songs.length} tracks`)
                                            )
                                        )
                                    ),
                                    
                                    React.createElement('div', { className: 'flex gap-3 mb-6', style: { flexWrap: 'wrap' } },
                                        React.createElement('button', { 
                                            onClick: () => fileInputRef.current?.click(), 
                                            className: 'btn-primary',
                                            style: { width: 'auto' }
                                        }, 'ðŸ“¤ Upload Files')
                                    ),
                                    
                                    currentPlaylist.songs.length > 0 ? currentPlaylist.songs.map((s, i) => 
                                        React.createElement('div', {
                                            key: s.id,
                                            onClick: () => playSong(s, currentPlaylist.id),
                                            className: `song-item ${card} ${currentSong?.id === s.id ? 'active' : ''}`,
                                            style: currentSong?.id === s.id ? { background: `${PRIMARY}20` } : {}
                                        },
                                            React.createElement('div', { className: 'drag-handle' }, 'â‹®â‹®'),
                                            React.createElement('div', { style: { flex: 1, minWidth: 0 } },
                                                React.createElement('div', { style: { fontWeight: '700', color: currentSong?.id === s.id ? PRIMARY : 'inherit' } }, s.name),
                                                React.createElement('div', { style: { fontSize: '13px', opacity: 0.7 } }, s.isUrl ? 'Streaming' : 'Local')
                                            ),
                                            React.createElement('button', {
                                                onClick: (e) => { 
                                                    e.stopPropagation(); 
                                                    setShowModal({ type: 'delete-song', id: s.id, pid: currentPlaylist.id }); 
                                                },
                                                className: 'icon-btn icon-btn-small'
                                            }, React.createElement(Icons.Trash))
                                        )
                                    ) : React.createElement('div', { 
                                        style: { textAlign: 'center', padding: '80px 20px', opacity: 0.5 }
                                    },
                                        React.createElement('div', { style: { fontSize: '20px', marginBottom: '8px' } }, 'No tracks yet'),
                                        React.createElement('div', {}, 'Upload audio files to get started')
                                    )
                                );
                            })()
                        )
                    )
                ),
                
                // MODALS
                showModal === 'create' && React.createElement('div', { 
                    className: 'modal-overlay',
                    onClick: (e) => e.target === e.currentTarget && setShowModal(null)
                },
                    React.createElement('div', { className: `modal ${modalClass}` },
                        React.createElement('div', { style: { fontSize: '24px', fontWeight: '700', marginBottom: '16px' } }, 'Create Playlist'),
                        React.createElement('input', {
                            type: 'text',
                            value: modalInput,
                            onChange: (e) => setModalInput(e.target.value),
                            placeholder: 'Playlist name',
                            style: { marginBottom: '16px' },
                            onKeyPress: (e) => e.key === 'Enter' && handleCreate(),
                            autoFocus: true
                        }),
                        React.createElement('div', { className: 'flex gap-3', style: { justifyContent: 'flex-end' } },
                            React.createElement('button', { onClick: () => setShowModal(null), className: 'btn-secondary' }, 'Cancel'),
                            React.createElement('button', { onClick: handleCreate, className: 'btn-primary' }, 'Create')
                        )
                    )
                ),
                
                showModal?.type === 'delete-playlist' && React.createElement('div', { 
                    className: 'modal-overlay',
                    onClick: (e) => e.target === e.currentTarget && setShowModal(null)
                },
                    React.createElement('div', { className: `modal ${modalClass}` },
                        React.createElement('div', { style: { fontSize: '20px', fontWeight: '700', marginBottom: '16px' } }, 'Delete Playlist?'),
                        React.createElement('div', { style: { marginBottom: '24px', opacity: 0.7 } }, 
                            'This will delete all songs in this playlist. This action cannot be undone.'
                        ),
                        React.createElement('div', { className: 'flex gap-3', style: { justifyContent: 'flex-end' } },
                            React.createElement('button', { onClick: () => setShowModal(null), className: 'btn-secondary' }, 'Cancel'),
                            React.createElement('button', { 
                                onClick: () => deletePlaylist(showModal.id), 
                                style: { background: '#dc2626', border: 'none', color: 'white', padding: '12px 28px', borderRadius: '50px', fontWeight: '600', cursor: 'pointer' }
                            }, 'Delete Playlist')
                        )
                    )
                ),
                
                showModal?.type === 'delete-song' && React.createElement('div', { 
                    className: 'modal-overlay',
                    onClick: (e) => e.target === e.currentTarget && setShowModal(null)
                },
                    React.createElement('div', { className: `modal ${modalClass}` },
                        React.createElement('div', { style: { fontSize: '20px', fontWeight: '700', marginBottom: '16px' } }, 'Delete Track?'),
                        React.createElement('div', { style: { marginBottom: '24px', opacity: 0.7 } }, 'This action cannot be undone.'),
                        React.createElement('div', { className: 'flex gap-3', style: { justifyContent: 'flex-end' } },
                            React.createElement('button', { onClick: () => setShowModal(null), className: 'btn-secondary' }, 'Cancel'),
                            React.createElement('button', { 
                                onClick: () => deleteSong(showModal.id, showModal.pid), 
                                style: { background: '#dc2626', border: 'none', color: 'white', padding: '12px 28px', borderRadius: '50px', fontWeight: '600', cursor: 'pointer' }
                            }, 'Delete')
                        )
                    )
                ),
                
                showModal === 'quota-help' && React.createElement('div', { 
                    className: 'modal-overlay',
                    onClick: (e) => e.target === e.currentTarget && setShowModal(null)
                },
                    React.createElement('div', { className: `modal ${modalClass}` },
                        React.createElement('div', { style: { fontSize: '24px', fontWeight: '700', marginBottom: '16px' } }, 'About Sync Activity'),
                        React.createElement('div', { style: { marginBottom: '12px' } },
                            React.createElement('strong', {}, 'What is this?'),
                            React.createElement('div', { style: { opacity: 0.8, marginTop: '4px' } }, 
                                `This shows how many times you've synced today. Current: ${quota.dailyCalls} syncs.`
                            )
                        ),
                        React.createElement('div', { style: { marginBottom: '12px' } },
                            React.createElement('strong', {}, 'Why does it matter?'),
                            React.createElement('div', { style: { opacity: 0.8, marginTop: '4px' } }, 
                                "Google has fair use limits. Normal usage is 1-5 syncs per day."
                            )
                        ),
                        React.createElement('div', { style: { marginBottom: '12px' } },
                            React.createElement('strong', {}, 'What if I see a warning?'),
                            React.createElement('div', { style: { opacity: 0.8, marginTop: '4px' } }, 
                                "Wait before syncing again. The counter resets at midnight."
                            )
                        ),
                        React.createElement('div', { style: { marginBottom: '24px' } },
                            React.createElement('strong', {}, 'Tip:'),
                            React.createElement('div', { style: { opacity: 0.8, marginTop: '4px' } }, 
                                "Add several songs, then sync once instead of syncing after each song."
                            )
                        ),
                        React.createElement('button', { onClick: () => setShowModal(null), className: 'btn-primary' }, 'Got it!')
                    )
                ),
                
                // PLAYER BAR
                currentSong && React.createElement('div', { className: `player ${card}` },
                    React.createElement('div', { className: 'player-info' },
                        React.createElement('div', { style: { fontWeight: '700', flex: 1, minWidth: '120px' } }, currentSong.name),
                        React.createElement('div', { style: { fontSize: '13px', opacity: 0.7 } }, 
                            formatTime(audioRef.current?.currentTime)
                        )
                    ),
                    
                    React.createElement('div', {
                        className: 'progress-bar',
                        onClick: (e) => {
                            const rect = e.currentTarget.getBoundingClientRect();
                            const pos = (e.clientX - rect.left) / rect.width;
                            if (audioRef.current && audioRef.current.duration) {
                                audioRef.current.currentTime = pos * audioRef.current.duration;
                            }
                        }
                    },
                        React.createElement('div', { className: 'progress-fill', style: { width: `${progress}%` } })
                    ),
                    
                    React.createElement('div', { className: 'player-main' },
                        React.createElement('div', { className: 'player-controls' },
                            React.createElement('button', { onClick: playPrevious, className: 'icon-btn' }, React.createElement(Icons.SkipBack)),
                            React.createElement('button', { onClick: () => setIsPlaying(!isPlaying), className: 'icon-btn', style: { background: PRIMARY, borderColor: PRIMARY } }, 
                                isPlaying ? React.createElement(Icons.Pause) : React.createElement(Icons.Play)
                            ),
                            React.createElement('button', { onClick: playNext, className: 'icon-btn' }, React.createElement(Icons.SkipForward)),
                            React.createElement('button', { 
                                onClick: () => setRepeat(!repeat), 
                                className: 'icon-btn',
                                style: { opacity: repeat ? 1 : 0.5, color: repeat ? PRIMARY : 'inherit' }
                            }, React.createElement(Icons.Repeat))
                        ),
                        React.createElement('div', { className: 'flex items-center gap-3 hide-mobile' },
                            React.createElement(Icons.Volume),
                            React.createElement('input', {
                                type: 'range',
                                min: 0,
                                max: 100,
                                value: volume,
                                onChange: (e) => setVolume(Number(e.target.value)),
                                style: { width: '100px' }
                            }),
                            React.createElement('span', { style: { minWidth: '40px', fontSize: '14px' } }, `${volume}%`)
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(MusicPlayer));
    </script>
</body>
</html>
